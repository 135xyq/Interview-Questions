# vue的响应式原理阐述

响应式的本质是当响应式对象以及响应式对象的属性发生变化时运行一些函数，最常见的就是组件的render函数。

vue通过defineProperty或者proxy将对象变成响应式对象，这样vue能劫持数据，当响应式对象以及响应式对象属性发生变化时vue能做一些额外的事情。

vue在创建响应式对象时，会给对象本身以及对象的每个属性对应一个dep实例，dep能做两件事:

- 收集依赖: 通过调用dep.depend()方法能将使用到响应式数据的函数收集为该数据的依赖。
- 派发更新: 当响应式数据发生变化时，通过调用dep.notify来通知那些用到该数据的函数，让他们重新运行。

现在还有一个问题，就是响应式数据在被读取时, 对应的dep实例是如何知道当前是哪个函数在使用该数据呢？

vue通过watcher来解决这个问题，每当运行函数时，并不是直接运行函数，而是创建一个watcher实例，将函数交给watcher来运行，watcher会将一个全局变量设置为当前函数，在函数运行过程中，响应式数据被读取时会执行dep.depend()该方法会将之前那个全局变量收集为自己的依赖。每个组件至少有一个watcher实例，即组件的render函数。

至此，每当响应式数据发生变化时，dep都会通知那些用到它的watcher重新运行，从而使相关联的组件更新。





