# 阐述一下vue的diff算法

组件创建或者组件重新渲染时,组件内部会运行_render方法创建出新的虚拟dom树, 然后运行_update方法并将新虚拟dom树的跟结点传入 ， 对比新旧虚拟dom树, 最终完成对真实dom的更改.

对比新旧结点差异的过程叫做diff, vue的diff算法是**深度优先遍历**并且**同层比较**.

具体来说, 新旧dom树对比由对比新旧根结点开始, 对比流程如下:

两个虚拟结点是否相同的评判标准如下:

    1. key值相同
    2. 类型相同(input元素还需要看type属性)

- 判断新旧结点是否相同

  - 若新旧结点不同, 则销毁旧结点对应的真实dom, 依据新结点递归创建出真实dom, 并将虚拟结点指向对应的真实dom
  - 若新旧结点相同, 则将旧结点指向的真实dom引用挂载到新结点上, 同时对比新旧虚拟结点属性的差异, 将差异同步到真实dom上

  ​        然后对比新旧结点的子结点列表

- 子结点列表对比

   vue会给新旧结点的子结点数组分别设置两个指针, 指向数组的头部和尾部, 通过改动指针不断向中间靠拢来进行对比, 这样做的目的是尽可能多地复用真实DOM, 减少真实dom的删除和新建. 指针移动过程中, 如果发现新旧结点相同, 则进入和根节点一样的对比流程, 否则移动dom到合适的位置。

  按照上述步骤递归遍历, 直至整个树对比完成.



  





