# vue的diff算法

在组件创建或者重新渲染时, 组件内部会调用render方法生成新的虚拟dom树, 然后将新树的根节点作为参数传入update函数调用update, update用来对比新旧虚拟dom树的最小化差异, 最终将差异同步更新到真实dom上

对比新旧树差异的过程叫做diff, vue的diff算法是深度优先遍历并且是同层比较

在比较过程中， vue判断两个虚拟dom结点是否相同的依据如下：

- 结点的类型是否相同
- 结点的key值是否相同

diff算法会先比较新旧树的根节点， 比较过程如下:

- 新旧根结点不同，则销毁旧结点指向的真实dom树， 按照新根结点递归创建出真实dom ，并且让虚拟dom指向对应的真实dom

- 新旧根结点相同:

    让旧结点指向的真实dom引用挂载到新结点上， 同时比较新旧结点的属性差异，将差异更新到真实dom上。然后开始比较新旧结点的子结点列表

子结点列表的比较过程如下:

  vue会给新旧结点的子结点数组都设置头尾指针， 分别指向数组的头部和尾部，通过指针不断向中间靠拢来进行对比。这样做的好处是最大化复用真实dom，减少真实dom的创建与删除。 指针移动过程中如果发现当前对比的新旧结点相同，则进入和根节点一样的处理流程。如果不同，则移动结点到合适的位置再进行比较。

如此递归遍历，直到整个树都遍历完成。



